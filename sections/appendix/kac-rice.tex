\section{Kac-Rice Formula}

In this section we will reproduce some results of
\textcite{adlerRandomFieldsGeometry2007} for easier reference but without
proofs.

Let \(f:\real^\dims\to\real^\dims\) and \(g:\real^\dims\to\real^K\)
be random fields. Let \(\Vol\subseteq \real^\dims\) be compact,
such that \(\partial\Vol\) has finite Hausdorff \(\mathcal{H}_{\dims-1}\)
measure and \(B\subseteq \real^K\) open, such that \(\partial B\) has Hausdorff
dimension \(K-1\).
Feel free to assume \(\Vol\) is a closed cuboid, \(B\) is an open cuboid, since
these are a generator of the Borel sets, so we only need to define our point
process \(\pp\) on them.
We define the level set count as
\[
	\level:= \level(f, g: \Vol, B) := \#\{t\in \Vol : f(t) = u, g(t)\in B\}.
\]
\begin{theorem}[Kac-Rice Formula ``Metatheorem'' {\cite[Theorem~11.2.1]{adlerRandomFieldsGeometry2007}}]
	\label{thm: general kac-rice}
	Let \(f,g,\Vol, B\) be as above. Assume that the following conditions are
	satisfied for some \(u\in\real^\dims\):	
	\begin{enumerate}[label={(\alph*)}]
		\item All components of \(f\), \(\nabla f\), and \(g\) are a.s. continuous
		and have finite variances (over \(\Vol\)).
		\item For all \(t\in\Vol\), the marginal densities \(p_t(x)\) of \(f(t)\)
		(implicitly assumed to exist) are continuous at \(x=u\).
		\item The conditional densities \(p_t(x\mid\nabla f(t), g(t))\) of \(f(t)\)
		given \(g(t)\) and \(\nabla f(t)\) (implicitly assumed to exist) are
		bounded above and continuous at \(x=u\), uniformly in \(t\in\Vol\).
		\item The conditional densities \(p_t(z\mid f(t) = x)\) of \(\det \nabla f(t)\)
		given \(f(t)=x\), are continuous for \(z\) and \(x\) in neighborhoods of \(0\)
		and \(u\), respectively, uniformly in \(t\in\Vol\).
		\item The conditional densities \(p_t(z\mid f(t) = x)\) of \(g(t)\)
		given \(f(t) = x\), are continuous for all \(z\) and for \(x\) in a
		neighborhood of \(u\), uniformly in \(t\in\Vol\).
		\item The following moment condition holds:
		\[
			\sup_{t\in\Vol}\max_{1\le i,j\le \dims} \E\left[
				\left|\frac{\partial f^i(t)}{\partial t_j}\right|^\dims
			\right] < \infty,
		\]
		where \(f^i\) is the \(i\)-th component of \(f\).
		\item The moduli of continuity\footnote{
			The modulus of continuity of a function \(F\) is defined as
			\[
				\omega_F(\eta):= \sup_{\|s-t\|^2\le \eta}|F(t)-F(s)|, \quad \eta>0.
			\]
		} with respect to the
		usual Euclidean norm of each of the components of \(f\), \(\nabla f\), and
		\(g\) satisfy
		\[
			\Pr(\omega(\eta) > \epsilon) = o(\eta^\dims) \quad\text{as }\eta\downarrow 0
		\]
		for any \(\epsilon>0\).
	\end{enumerate}
	Then we have
	\begin{equation}
		\E[\level] = \int_\Vol \E\left[
			|\det \nabla f(t)| \ind_B(g(t)) \mid f(t) = u
		\right] p_t(u)dt,
	\end{equation}
	where \(p_t\) is the density of \(f(t)\).	
\end{theorem}
\begin{proof}
	See \textcite[Section~11.2]{adlerRandomFieldsGeometry2007}. Another proof
	using a different approach can be found in
	\textcite[Theorem~6.4]{azaisLevelSetsExtrema2009}. The main ingredients for
	this alternate proof are also sketched in
	\textcite[Section~11.4]{adlerRandomFieldsGeometry2007}.
\end{proof}

\begin{corollary}[Gaussian Rice Formula {\cite[Corollary~11.2.2]{adlerRandomFieldsGeometry2007}}]
	\label{cor: gaussian kac-rice}
	Let \(f\) and \(g\) be centered Gaussian random fields over a \(\Vol\subseteq
	\real^\dims\) which satisfies the conditions of Theorem~\ref{thm: general
	kac-rice} (e.g. a closed cuboid). Assume that for each \(t\in\Vol\) the joint
	distributions of \((f(t), \nabla f(t), g(t))\)
	are nondegenerate, and there exists \(K>0\), \(\alpha>0\) such that
	for \(|s-t|\) small enough
	\begin{align*}
		\max_{i,j\le\dims}|\C_{\partial_j f^i}(t,t) + \C_{\partial_j f^i}(s,s) - 2\C_{\partial_j f^i}(s,t)|
		&\le K | \ln(|t-s|)|^{-(1+\alpha)}\\
		\max_{i\le K}	|\C_{g^i}(t,t) + \C_{g^i}(s,s) - 2\C_{g^i}(s,t)|
		&\le K | \ln(|t-s|)|^{-(1+\alpha)}
	\end{align*}
	for \(f^i\) and \(g^i\), the \(i\)-th component of \(f\) and \(g\) with
	\[
		\C_{Z}(s,t) := \Cov(Z(s), Z(t)).
	\]
	Then we have
	\begin{equation}
		\E[\level] = \int_\Vol \E\left[
			|\det \nabla f(t)| \ind_B(g(t)) \mid f(t) = u
		\right] p_t(u)dt,
	\end{equation}
	where \(p_t\) is the density of \(f(t)\).	
 \end{corollary}
